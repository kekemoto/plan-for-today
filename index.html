
<!DOCTYPE html>
<html>
	<head>
		<style>
			h1{
				text-align: center;
				margin: 1em;
			}

			section{
				width:40em;
				margin: 0 auto;
			}

			span{
				margin-left: 1em;
			}

			input{margin: 1em;}

			.check{
				display: inline-block;
				width: 10px;
				height: 10px;
				border: solid 1px;
				background-color: white;
				cursor: pointer;
			}

			.list{margin: 1em}

			@media screen and (max-width: 42em){
				section{
					width: 90%;
					margin: 0 auto;
				}
			}
		</style>

		<script type="text/javascript">
			window.onload = function(){
				/*
				var checkElement = document.getElementsByClassName("check");
				for(var i=0; i<checkElement.length; i++){
					checkElement[i].addEventListener("click", check, false);
				}*/

				loadList();

				document.getElementById("input").addEventListener("keyup", enter, false);
				document.getElementById("delete").addEventListener("click", remove, false);
			}

			function loadList(){
				var cookies = cookieLoad();

				var checkList = {};
				var valueList = {};
				for(var key in cookies){
					if(cookies[key] != ""){
						if(-1 != key.indexOf("check")){
							checkList[key.charAt(5)] = cookies[key];
						}
						else if(-1 != key.indexOf("value")){
							valueList[key.charAt(5)] = unescape(cookies[key]);
						}
					}
				}

				for(var key in valueList){
					generation(valueList[key], checkList[key]);
				}
			}

			function check(e){
				if("rgb(255, 255, 255)" == document.defaultView.getComputedStyle(e.target, "").getPropertyValue("background-color")){
					e.target.style.backgroundColor = "black";
					document.cookie = e.target.id + "=black";
				}
				else{
					e.target.style.backgroundColor = "white";
					document.cookie = e.target.id + "=white";
				}
			}

			function generation(value,color){
					var board = document.getElementById("board");

					var list = document.createElement("div");
					list.className = "list";
					board.appendChild(list);
					
					var id = document.getElementById("board").childElementCount-1;
					var checkBox = document.createElement("div");
					checkBox.className = "check";
					checkBox.id = "check" + id;
					checkBox.style.backgroundColor = color;
					checkBox.addEventListener("click", check, false);
					list.appendChild(checkBox);

					var span = document.createElement("span");
					span.innerText= value;
					span.textContent= value;
					list.appendChild(span);
			}

			function enter(e){
				if(13 == e.keyCode){
					generation(e.target.value, 0);
					cookieWrite();
					e.target.value = "";
				}
			}

			function cookieWrite(){
				var cookies = cookieLoad();

				for(var key in cookies){
					document.cookie = key + "=";
				}

				//checkBox memorize
				var checkBox = document.getElementsByClassName("check");
				var checkList = [];
				for(var i=0; i<checkBox.length; i++){
					if("rgb(255, 255, 255)" == document.defaultView.getComputedStyle(checkBox[i], "").getPropertyValue("background-color"))
						checkList.push("white");
					else
						checkList.push("black");
				}

				//value of span memorize
				var span = document.getElementsByTagName("span");
				var spanList = [];
				for(var i=0; i<span.length; i++){
					spanList.push(span[i].innerHTML);
				}

				//write cookie
				for(var i=0; i<span.length; i++){
					document.cookie = 'check' + i + '=' + escape(checkList[i]);
					document.cookie = 'value' + i + '=' + escape(spanList[i]);
				}

				//expires
				var time = new Date();
				time.setTime(time.getTime() + 2*24*60*60*1000);	//ìÒì˙ä‘ÇÃóLå¯ä˙å¿
				time = time.toGMTString();

				document.cookie = 'expires=' + time;
				document.cookie = 'max-age=' + 2*24*60*60*1000;	//ìÒì˙ä‘ÇÃóLå¯ä˙å¿
			}

			function cookieLoad(){
				//load and delete
				var cookieCrumb = document.cookie.split("; ");
				var cookies = {};

				//initialization
				for(var i=0; i<cookieCrumb.length; i++){
					var crumb = cookieCrumb[i].split("=");
					cookies[crumb[0]] = crumb[1];
				}

				return cookies;
			}

			function remove(){
				var board= document.getElementById("board");
				var count = board.childElementCount;
				console.log(count);
				for(var i=0; i<count; i++){
					console.log(i);
					board.removeChild(board.children[0]);
				}
				cookieWrite();
			}
		</script>
	</head>
	<body>
		<h1>Plan for Today</h1>
		<section>
			<div id="board">
				<!--<div class="list"><div class="check"></div><span>Plan for TodayÇçÏÇÈ</span></div>-->
			</div>
			<input type="text" placeholder="writing a plan" id="input">
			<input type="button" value="Delete" id="delete">
		</section>
	</body>
</html>
